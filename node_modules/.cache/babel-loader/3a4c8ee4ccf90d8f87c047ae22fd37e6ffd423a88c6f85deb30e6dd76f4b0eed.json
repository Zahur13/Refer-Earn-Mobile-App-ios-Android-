{"ast":null,"code":"import _objectSpread from\"/Users/zahurshaikh/Documents/Refer-Earn-APP/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import{db}from\"./config\";import{collection,addDoc,query,where,getDocs,updateDoc,doc,orderBy,limit,serverTimestamp}from\"firebase/firestore\";/**\n * Create a notification for a user\n */export const createNotification=async(userId,notificationData)=>{try{await addDoc(collection(db,\"notifications\"),{userId:userId,type:notificationData.type,title:notificationData.title,message:notificationData.message,amount:notificationData.amount||null,read:false,createdAt:serverTimestamp()});// console.log(\"✅ Notification created for user:\", userId);\n// Request browser notification permission and show\nif(\"Notification\"in window&&Notification.permission===\"granted\"){new Notification(notificationData.title,{body:notificationData.message,icon:\"/logo192.png\",badge:\"/logo192.png\",tag:\"notification-\".concat(Date.now())});}return{success:true};}catch(error){console.error(\"Error creating notification:\",error);return{success:false,error};}};/**\n * Get notifications for a user\n */export const getUserNotifications=async function(userId){let limitCount=arguments.length>1&&arguments[1]!==undefined?arguments[1]:10;try{const q=query(collection(db,\"notifications\"),where(\"userId\",\"==\",userId),orderBy(\"createdAt\",\"desc\"),limit(limitCount));const snapshot=await getDocs(q);const notifications=snapshot.docs.map(doc=>_objectSpread({id:doc.id},doc.data()));return notifications;}catch(error){console.error(\"Error fetching notifications:\",error);return[];}};/**\n * Mark notification as read\n */export const markNotificationAsRead=async notificationId=>{try{await updateDoc(doc(db,\"notifications\",notificationId),{read:true,readAt:serverTimestamp()});return{success:true};}catch(error){console.error(\"Error marking notification as read:\",error);return{success:false};}};/**\n * Mark all notifications as read for a user\n */export const markAllNotificationsAsRead=async userId=>{try{const q=query(collection(db,\"notifications\"),where(\"userId\",\"==\",userId),where(\"read\",\"==\",false));const snapshot=await getDocs(q);const updatePromises=snapshot.docs.map(docSnapshot=>updateDoc(doc(db,\"notifications\",docSnapshot.id),{read:true,readAt:serverTimestamp()}));await Promise.all(updatePromises);return{success:true};}catch(error){console.error(\"Error marking all notifications as read:\",error);return{success:false};}};/**\n * Get unread notification count\n */export const getUnreadNotificationCount=async userId=>{try{const q=query(collection(db,\"notifications\"),where(\"userId\",\"==\",userId),where(\"read\",\"==\",false));const snapshot=await getDocs(q);return snapshot.size;}catch(error){console.error(\"Error getting unread count:\",error);return 0;}};/**\n * Request browser notification permission\n */export const requestNotificationPermission=async()=>{if(!(\"Notification\"in window)){console.log(\"This browser does not support notifications\");return false;}if(Notification.permission===\"granted\"){return true;}if(Notification.permission!==\"denied\"){const permission=await Notification.requestPermission();return permission===\"granted\";}return false;};","map":{"version":3,"names":["db","collection","addDoc","query","where","getDocs","updateDoc","doc","orderBy","limit","serverTimestamp","createNotification","userId","notificationData","type","title","message","amount","read","createdAt","window","Notification","permission","body","icon","badge","tag","concat","Date","now","success","error","console","getUserNotifications","limitCount","arguments","length","undefined","q","snapshot","notifications","docs","map","_objectSpread","id","data","markNotificationAsRead","notificationId","readAt","markAllNotificationsAsRead","updatePromises","docSnapshot","Promise","all","getUnreadNotificationCount","size","requestNotificationPermission","log","requestPermission"],"sources":["/Users/zahurshaikh/Documents/Refer-Earn-APP/src/firebase/notificationService.js"],"sourcesContent":["import { db } from \"./config\";\nimport {\n  collection,\n  addDoc,\n  query,\n  where,\n  getDocs,\n  updateDoc,\n  doc,\n  orderBy,\n  limit,\n  serverTimestamp,\n} from \"firebase/firestore\";\n\n/**\n * Create a notification for a user\n */\nexport const createNotification = async (userId, notificationData) => {\n  try {\n    await addDoc(collection(db, \"notifications\"), {\n      userId: userId,\n      type: notificationData.type,\n      title: notificationData.title,\n      message: notificationData.message,\n      amount: notificationData.amount || null,\n      read: false,\n      createdAt: serverTimestamp(),\n    });\n\n    // console.log(\"✅ Notification created for user:\", userId);\n\n    // Request browser notification permission and show\n    if (\"Notification\" in window && Notification.permission === \"granted\") {\n      new Notification(notificationData.title, {\n        body: notificationData.message,\n        icon: \"/logo192.png\",\n        badge: \"/logo192.png\",\n        tag: `notification-${Date.now()}`,\n      });\n    }\n\n    return { success: true };\n  } catch (error) {\n    console.error(\"Error creating notification:\", error);\n    return { success: false, error };\n  }\n};\n\n/**\n * Get notifications for a user\n */\nexport const getUserNotifications = async (userId, limitCount = 10) => {\n  try {\n    const q = query(\n      collection(db, \"notifications\"),\n      where(\"userId\", \"==\", userId),\n      orderBy(\"createdAt\", \"desc\"),\n      limit(limitCount)\n    );\n\n    const snapshot = await getDocs(q);\n    const notifications = snapshot.docs.map((doc) => ({\n      id: doc.id,\n      ...doc.data(),\n    }));\n\n    return notifications;\n  } catch (error) {\n    console.error(\"Error fetching notifications:\", error);\n    return [];\n  }\n};\n\n/**\n * Mark notification as read\n */\nexport const markNotificationAsRead = async (notificationId) => {\n  try {\n    await updateDoc(doc(db, \"notifications\", notificationId), {\n      read: true,\n      readAt: serverTimestamp(),\n    });\n    return { success: true };\n  } catch (error) {\n    console.error(\"Error marking notification as read:\", error);\n    return { success: false };\n  }\n};\n\n/**\n * Mark all notifications as read for a user\n */\nexport const markAllNotificationsAsRead = async (userId) => {\n  try {\n    const q = query(\n      collection(db, \"notifications\"),\n      where(\"userId\", \"==\", userId),\n      where(\"read\", \"==\", false)\n    );\n\n    const snapshot = await getDocs(q);\n\n    const updatePromises = snapshot.docs.map((docSnapshot) =>\n      updateDoc(doc(db, \"notifications\", docSnapshot.id), {\n        read: true,\n        readAt: serverTimestamp(),\n      })\n    );\n\n    await Promise.all(updatePromises);\n    return { success: true };\n  } catch (error) {\n    console.error(\"Error marking all notifications as read:\", error);\n    return { success: false };\n  }\n};\n\n/**\n * Get unread notification count\n */\nexport const getUnreadNotificationCount = async (userId) => {\n  try {\n    const q = query(\n      collection(db, \"notifications\"),\n      where(\"userId\", \"==\", userId),\n      where(\"read\", \"==\", false)\n    );\n\n    const snapshot = await getDocs(q);\n    return snapshot.size;\n  } catch (error) {\n    console.error(\"Error getting unread count:\", error);\n    return 0;\n  }\n};\n\n/**\n * Request browser notification permission\n */\nexport const requestNotificationPermission = async () => {\n  if (!(\"Notification\" in window)) {\n    console.log(\"This browser does not support notifications\");\n    return false;\n  }\n\n  if (Notification.permission === \"granted\") {\n    return true;\n  }\n\n  if (Notification.permission !== \"denied\") {\n    const permission = await Notification.requestPermission();\n    return permission === \"granted\";\n  }\n\n  return false;\n};\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}